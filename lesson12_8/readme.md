### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

### Ответ:

1.1. Подойдет дифференциальный бэкап. Нужно настроить полное резервное копирование раз в неделю и каждый день будут копироваться измененные файлы относительно полной копии.
При таком резервном копировании для восстановления данных за предыдущий день потребуется только последний полный бэкап и последний дифференциальный.
Не нужно будет восстанавливать цепочку изменных данных за все дни до нужного.

1.2. Можно настроить инкрементное резервное копирование, чтобы полная резервная копия создавалась раз в сутки, а каждый час копия измененных файлов относительно предыдущего часа.
При таких настройках резервного копирования бэкап будет занимать меньше места, что важно, так как требуется хранить копии данных каждый час, но восстановление займет больше времени, что допустимо, так как поломки происходят не каждый день.

1.3. Для переключения на работающую базу данных в момент поломки основной требуется настроить репликацию. В этом случае основная база данных реплицируется на одну или несколько резервных баз данных. Если основная база данных перестает работать, система автоматически переключается на резервную базу данных, и пользователи продолжают работать с ней без заметных проблем. Когда основная база данных восстанавливается, изменения между поломкой и восстановлением реплицируются на основную базу данных, чтобы гарантировать целостность данных. Это обеспечивает быстрое восстановление и минимальное простоя системы.

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

### Ответ:

2.1.

pg_dump -U <пользователь> -d <база данных> -f <файл_резерва>


где:
- `<пользователь>` - имя пользователя базы данных
- `<база данных>` - имя базы данных
- `<файл_резерва>` - путь к файлу, в который будет сохранен резервный дамп

Пример команды восстановления базы данных с использованием утилиты pg_restore:


pg_restore -U <пользователь> -d <база данных> <файл_резерва>


где:
- `<пользователь>` - имя пользователя базы данных
- `<база данных>` - имя базы данных
- `<файл_резерва>` - путь к файлу резервного дампа

2.1.* Да, процесс резервирования и восстановления базы данных можно автоматизировать. Например, можно создать скрипт на языке программирования, который будет запускать команды pg_dump и pg_restore в заданное время или по расписанию. Этот скрипт можно запускать с помощью планировщика задач операционной системы (например, cron в Linux или Task Scheduler в Windows). Также можно использовать специализированные инструменты для автоматизации управления базами данных, такие как Ansible, Chef или Puppet.

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

### Ответ:

mysqldump --user=username --password=password --single-transaction --master-data=2 --databases database_name > backup.sql


В этой команде:
- `--user=username` - указывает имя пользователя для подключения к базе данных MySQL.
- `--password=password` - указывает пароль для подключения к базе данных MySQL.
- `--single-transaction` - выполняет резервное копирование в рамках одной транзакции, чтобы избежать блокировки таблиц при копировании.
- `--master-data=2` - включает информацию о бинарных журналах и позиции бинарного журнала в резервную копию.
- `--databases database_name` - указывает имя базы данных, которую нужно скопировать.
- `> backup.sql` - перенаправляет вывод команды в файл с именем "backup.sql".

3.1.* Использование реплики может быть выгодно по сравнению с обычным резервным копированием в следующих случаях:

1. Увеличение доступности: Реплика может использоваться для обслуживания запросов, в то время как основная база данных находится в режиме резервного копирования. Это позволяет минимизировать простои и обеспечить непрерывную доступность для пользователей.

2. Быстрое восстановление: При использовании реплики, восстановление базы данных после сбоя может быть быстрее, так как реплика уже содержит актуальные данные и может быть просто переключена в режим основной базы данных.

3. Распределение нагрузки: Реплика может использоваться для распределения нагрузки на чтение, что позволяет улучшить производительность системы и обеспечить более быстрый отклик для пользователей.

4. Географическая репликация: Реплика может быть размещена на удаленном сервере в другом географическом регионе, что обеспечивает дополнительную защиту от потери данных в случае катастрофы или сбоя в основной базе данных.
